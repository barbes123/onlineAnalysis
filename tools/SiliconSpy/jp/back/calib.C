double param[6][16][2] = {
  //board 4
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {1.941294491,-269.5166183},
    {1.794579292,130.527905},
    {1.81404193,116.3061687},
    {1.794294072,122.6737897},
    {1.797971079,133.5782892},
    {1.858369125,138.0838576},
    {1.865911593,106.2599234},
    {1.795777002,145.2710047},
    {1.76724457,122.8492888},
    {1.764263173,131.8657182},
    {1.83054208,109.8948107},
    {1.788191291,134.3373902},
    {1.819349944,140.6741817},
    {1.801639765,119.121586}
  },
  //board 5
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {1.855925711, 125.9377826},
    {1.8585837, 143.3168574},
    {1.855374662, 131.4200211},
    {1.799910263, 110.6724008},
    {1.985712474, 114.7101703},
    {1.85434737, 141.8536708},
    {1.808633394, 143.8537154},
    {1.828959952, 132.8941309},
    {1.85904655, 104.7790635},
    {1.889340973, 81.16302441},
    {1.896781052, 121.1868417},
    {1.965794347, 89.31107974},
    {1.82449304, 103.6796338},
    {1.891092312, 112.4854833}
  },
  //board 6		   
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {1.866113099, 124.3047643},
    {1.960157158, 71.44350657},
    {1.851404669, 207.7478081},
    {1.854148432, 117.517614 },
    {1.866935954, 112.9999019},
    {1.847160328, 114.5789919},
    {1.788437196, 113.5794746},
    {1.884088475, 84.77609051},
    {1.794600758, 136.2307164},
    {1.862223051, 97.19278111},
    {2.323384185, 99.95991145},
    {2.367861975, 128.0087576},
    {1.742960993, 141.7918281},
    {1.814115079, 128.0454084} 
  },
  //board 7
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {1.898725122, 88.26442896},
    {1.862033559, 95.33099898},
    {1.829268924, 134.9685671},
    {1.808036326, 343.1933418},
    {1.81236541, 139.9068812},
    {1.833025874, 99.96752093},
    {1.826894961, 113.3831675},
    {1.825278472, 102.6969561},
    {1.826996143, 120.4859708},
    {1.875434832, 97.57705338},
    {1.872471418, 85.66457251},
    {1.86013651, 101.5667496},
    {1.888464432, 112.6183713},
    {1.872297458, 93.11702335} 
  },
  //board 8
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {1.957556894, 111.6973272},
    {1.996799924, 90.02113688},
    {1.900372625, 88.94339082},
    {1.906456456, 83.81814212},
    {1.849253058, 108.6933009},
    {1.976384813, 71.85961684},
    {1.976472431, 75.98842347},
    {1.915958707, 92.80067438},
    {2.110493555, 98.8212839 },
    {2.062535569, 70.88901821},
    {2.238758059, 70.69046973},
    {2.094162527, 79.91195236},
    {2.037035119, 87.29481935},
    {2.079282449, 87.97388392} 
  },
  //board 9
  {
    {1.0, 0.0},
    {1.0, 0.0},
    {2.087513059,67.18796648},
    {2.024943241,73.37977616},
    {2.134134529,99.31515922},
    {2.099707861,94.95081885},
    {2.055075467,76.40606422},
    {1.981523878,41.43612956},
    {2.025879426,71.1155777},
    {2.017817809,72.86831104},
    {2.102265769,78.93878188},
    {2.033253659,67.65770306},
    {1.0, 0.0},
    {1.0, 0.0},
    {1.0, 0.0},
    {1.0, 0.0}
  }
};

int calib(int runno, int vol1, int vol2){
  TFile *fin = new TFile(Form("./chain/chain%4d_%d_%d.root", runno, vol1, vol2),"READ");

  fin->cd();
  TTree *tree = (TTree*)fin->Get("ELIADE_Tree");
  int nevent = tree->GetEntries();

  UShort_t ChargeLong;
  UChar_t Mod;
  UChar_t Ch;

  Double_t clong=0;
  Int_t mod=0;
  Int_t ch=0;

  TH2D *h2dr = new TH2D("h2dr","raw", 100,100,200,1000,0,10000);
  TH2D *h2dc = new TH2D("h2dc","calib", 100,100,200,1000,0,40000);

  tree->SetBranchAddress("ChargeLong", &ChargeLong);
  tree->SetBranchAddress("Mod", &Mod);
  tree->SetBranchAddress("Ch", &Ch);

  // for(int i=0;i<5000000;i++){
  for(int i=0;i<nevent;i++){
    tree->GetEntry(i);

    clong=(Double_t)ChargeLong;
    mod=(Int_t)Mod;
    ch=(Int_t)Ch;

    if(mod>=4 && mod<=9){
      h2dr->Fill(100+(mod-4)*16+ch, clong);
      h2dc->Fill(100+(mod-4)*16+ch,
		 (clong*param[mod-4][ch][0]+param[mod-4][ch][1])
		 );
    }
    if(i%100000) std::cout << "Event: " << i << std::endl;
  }

  TFile *fout = new TFile(Form("./chain%4d_calib_%d_%d.root", runno, vol1, vol2),"RECREATE");
  fout->cd();

  h2dr->Write();
  h2dc->Write();

  fout->Close();
  fin->Close();
  
  return 0;
}
